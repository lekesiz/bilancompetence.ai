# BilanCompetence.AI - Comprehensive Deployment Guide\n\n**Version**: 1.0.0  \n**Last Updated**: October 27, 2025  \n**Status**: Production Ready ✅\n\n---\n\n## Table of Contents\n\n1. [Pre-Deployment Requirements](#pre-deployment-requirements)\n2. [Environment Configuration](#environment-configuration)\n3. [Local Development Setup](#local-development-setup)\n4. [Docker Deployment](#docker-deployment)\n5. [Production Deployment](#production-deployment)\n6. [Database Setup](#database-setup)\n7. [SSL/TLS Configuration](#ssltls-configuration)\n8. [Monitoring & Logging](#monitoring--logging)\n9. [Backup & Disaster Recovery](#backup--disaster-recovery)\n10. [Rollback Procedures](#rollback-procedures)\n11. [Troubleshooting](#troubleshooting)\n\n---\n\n## Pre-Deployment Requirements\n\n### System Requirements\n\n**Server Specifications:**\n- **CPU**: 2+ cores (4+ recommended for production)\n- **RAM**: 4GB+ (8GB recommended for production)\n- **Disk**: 50GB+ SSD (for database and logs)\n- **OS**: Ubuntu 20.04+ or equivalent Linux\n\n**Software Requirements:**\n- Node.js 18.x LTS or higher\n- npm 8.x or higher\n- Docker 20.10+ (for containerized deployment)\n- PostgreSQL 13+ (if not using Supabase)\n- Redis 6+ (for caching and real-time)\n- Nginx 1.18+ (for reverse proxy)\n\n### Domain & DNS\n\n1. **Purchase domain**: `bilancompetence.ai`\n2. **Update DNS records**:\n   ```\n   A record: api.bilancompetence.ai → Your API Server IP\n   A record: app.bilancompetence.ai → Your Frontend Server IP\n   MX record: bilancompetence.ai → Mail server\n   ```\n\n### SSL/TLS Certificates\n\n1. **Obtain certificates** from Let's Encrypt or Certbot\n2. **Certificate paths**:\n   - `/etc/letsencrypt/live/bilancompetence.ai/fullchain.pem`\n   - `/etc/letsencrypt/live/bilancompetence.ai/privkey.pem`\n\n---\n\n## Environment Configuration\n\n### 1. Copy Environment Template\n\n```bash\ncp .env.example .env.production\n```\n\n### 2. Configure Environment Variables\n\nEdit `.env.production` with production values:\n\n```bash\n# Application\nNODE_ENV=production\nAPP_URL=https://bilancompetence.ai\nFRONTEND_URL=https://app.bilancompetence.ai\n\n# Database (Supabase)\nSUPABASE_URL=https://your-project.supabase.co\nSUPABASE_ANON_KEY=your_key\nSUPABASE_SERVICE_KEY=your_key\nDATABASE_URL=postgresql://user:pass@host:5432/db\n\n# JWT\nJWT_SECRET=$(openssl rand -base64 32)\n\n# Email\nSENDGRID_API_KEY=your_sendgrid_key\nSENDGRID_FROM_EMAIL=noreply@bilancompetence.ai\n\n# Redis\nREDIS_URL=redis://localhost:6379\n\n# Monitoring\nSENTRY_DSN=your_sentry_dsn\n```\n\n### 3. Secure Environment File\n\n```bash\nchmod 600 .env.production\nchown root:root .env.production\n```\n\n---\n\n## Local Development Setup\n\n### 1. Install Dependencies\n\n```bash\n# Clone repository\ngit clone https://github.com/your-org/bilancompetence.ai.git\ncd BilanCompetence.AI\n\n# Install root dependencies\nnpm install\n\n# Install workspace dependencies\nnpm ci\n```\n\n### 2. Setup Database (Local)\n\n```bash\n# Using Docker\ndocker run -d \\\n  --name postgres \\\n  -e POSTGRES_PASSWORD=password \\\n  -p 5432:5432 \\\n  postgres:15-alpine\n\n# Run migrations\ncd apps/backend\nnpm run migrate:up\ncd ../..\n```\n\n### 3. Start Development Servers\n\n```bash\n# Terminal 1: Backend\ncd apps/backend\nnpm run dev\n\n# Terminal 2: Frontend\ncd apps/frontend\nnpm run dev\n\n# Terminal 3: Mobile (Optional)\ncd apps/mobile\nnpm start\n```\n\n### 4. Access Development Environment\n\n- **Frontend**: http://localhost:3000\n- **Backend API**: http://localhost:3001\n- **API Documentation**: http://localhost:3001/api/docs\n- **Health Check**: http://localhost:3001/health\n\n---\n\n## Docker Deployment\n\n### 1. Build Docker Images\n\n```bash\n# Build backend\ndocker build -t bilancompetence-api:1.0.0 -f Dockerfile.backend .\n\n# Build frontend (if Dockerfile exists)\ncd apps/frontend\ndocker build -t bilancompetence-frontend:1.0.0 .\ncd ../..\n```\n\n### 2. Using Docker Compose\n\n```bash\n# Start all services\ndocker-compose -f docker-compose.yml up -d\n\n# View logs\ndocker-compose logs -f backend\n\n# Stop services\ndocker-compose down\n\n# Remove volumes (⚠️ deletes data)\ndocker-compose down -v\n```\n\n### 3. Docker Compose Configuration\n\nServices included:\n- **PostgreSQL**: Database\n- **Redis**: Caching & sessions\n- **Backend**: API server (port 3001)\n- **Frontend**: Web app (port 3000)\n- **Nginx**: Reverse proxy (ports 80, 443)\n\n---\n\n## Production Deployment\n\n### 1. Server Setup\n\n```bash\n# SSH into production server\nssh root@your-api-server.com\n\n# Update system\nsudo apt update && sudo apt upgrade -y\n\n# Install dependencies\nsudo apt install -y nodejs npm nginx curl wget\n\n# Install Docker (optional)\nsudo apt install -y docker.io docker-compose\nsudo usermod -aG docker $USER\n```\n\n### 2. Clone Repository\n\n```bash\ncd /var/www\nsudo git clone https://github.com/your-org/bilancompetence.ai.git\ncd bilancompetence.ai\nsudo chown -R $USER:$USER .\n```\n\n### 3. Configure Environment\n\n```bash\n# Copy environment file\ncp .env.example .env.production\n\n# Edit with production values\nnano .env.production\n\n# Secure it\nchmod 600 .env.production\n```\n\n### 4. Run Deployment Script\n\n```bash\n# Make script executable\nchmod +x scripts/deploy.sh\n\n# Run deployment\nsudo ./scripts/deploy.sh production\n```\n\n### 5. Verify Deployment\n\n```bash\n# Check services\nsudo systemctl status bilancompetence-api\nsudo systemctl status bilancompetence-frontend\n\n# Check health\ncurl https://api.bilancompetence.ai/health\n\n# Check readiness\ncurl https://api.bilancompetence.ai/ready\n\n# View logs\nsudo journalctl -u bilancompetence-api -f\n```\n\n---\n\n## Database Setup\n\n### 1. Supabase Setup (Recommended)\n\n```bash\n# 1. Create Supabase project at https://supabase.com\n# 2. Get credentials:\n#    - Project URL (SUPABASE_URL)\n#    - Anon key (SUPABASE_ANON_KEY)\n#    - Service key (SUPABASE_SERVICE_KEY)\n#    - JWT secret (JWT_SECRET)\n\n# 3. Run migrations\ncd apps/backend\nSUPABASE_URL=https://xxx.supabase.co \\\nSUPABASE_SERVICE_KEY=xxx \\\nnpm run migrate:up\n```\n\n### 2. Local PostgreSQL Setup\n\n```bash\n# Create database\nsudo -u postgres createdb bilancompetence\n\n# Create user\nsudo -u postgres createuser bilancompetence_user\nsudo -u postgres psql -c \"ALTER USER bilancompetence_user WITH PASSWORD 'secure_password';\"\n\n# Grant privileges\nsudo -u postgres psql -d bilancompetence -c \"GRANT ALL PRIVILEGES ON SCHEMA public TO bilancompetence_user;\"\n\n# Run migrations\nDATABASE_URL=postgresql://bilancompetence_user:password@localhost/bilancompetence npm run migrate:up\n```\n\n### 3. Backup Strategy\n\n```bash\n# Daily backup\n0 2 * * * pg_dump $DATABASE_URL | gzip > /backups/db-$(date +\\%Y\\%m\\%d).sql.gz\n\n# Retention policy: Keep 30 days of backups\nfind /backups -name 'db-*.sql.gz' -mtime +30 -delete\n```\n\n---\n\n## SSL/TLS Configuration\n\n### 1. Generate Certificates with Let's Encrypt\n\n```bash\n# Install Certbot\nsudo apt install -y certbot python3-certbot-nginx\n\n# Generate certificate\nsudo certbot certonly --nginx -d bilancompetence.ai -d api.bilancompetence.ai -d app.bilancompetence.ai\n\n# Set auto-renewal\nsudo systemctl enable certbot.timer\n```\n\n### 2. Nginx Configuration\n\n```nginx\n# /etc/nginx/sites-available/bilancompetence\n\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name bilancompetence.ai api.bilancompetence.ai app.bilancompetence.ai;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name api.bilancompetence.ai;\n\n    ssl_certificate /etc/letsencrypt/live/bilancompetence.ai/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/bilancompetence.ai/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    location / {\n        proxy_pass http://localhost:3001;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\n---\n\n## Monitoring & Logging\n\n### 1. Application Logs\n\n```bash\n# Backend logs\ntail -f logs/combined.log\ntail -f logs/error.log\n\n# System logs\nsudo journalctl -u bilancompetence-api -f\nsudo journalctl -u bilancompetence-frontend -f\n```\n\n### 2. Health Monitoring\n\n```bash\n# Health check endpoint\ncurl https://api.bilancompetence.ai/health\n\n# Readiness check\ncurl https://api.bilancompetence.ai/ready\n\n# Metrics\ncurl https://api.bilancompetence.ai/metrics\n\n# Status report\ncurl https://api.bilancompetence.ai/status\n```\n\n### 3. Uptime Monitoring (Recommended Services)\n\n- **Uptime Robot**: Free uptime monitoring\n- **New Relic**: APM and monitoring\n- **Datadog**: Comprehensive monitoring\n- **Prometheus**: Open-source monitoring\n\n### 4. Error Tracking\n\n```bash\n# Sentry integration (set SENTRY_DSN in environment)\nexport SENTRY_DSN=https://xxx@sentry.io/xxx\n\n# View Sentry dashboard for error reports\nhttps://sentry.io/organizations/your-org/\n```\n\n---\n\n## Backup & Disaster Recovery\n\n### 1. Automated Daily Backup\n\n```bash\n#!/bin/bash\n# /usr/local/bin/backup-bilancompetence.sh\n\nBACKUP_DIR=\"/backups/bilancompetence\"\nDATE=$(date +%Y%m%d-%H%M%S)\n\n# Database backup\npg_dump $DATABASE_URL | gzip > ${BACKUP_DIR}/db-${DATE}.sql.gz\n\n# File storage backup\ntar -czf ${BACKUP_DIR}/files-${DATE}.tar.gz /var/www/bilancompetence/uploads/\n\n# Upload to cloud\ngsutil -m cp ${BACKUP_DIR}/* gs://bilancompetence-backups/\n\n# Cleanup old backups (keep 30 days)\nfind ${BACKUP_DIR} -mtime +30 -delete\n```\n\n### 2. Add to Crontab\n\n```bash\n# Daily backup at 2 AM\n0 2 * * * /usr/local/bin/backup-bilancompetence.sh >> /var/log/backups.log 2>&1\n```\n\n### 3. Restore from Backup\n\n```bash\n# Restore database\ngunzip < backups/db-20251027-120000.sql.gz | psql $DATABASE_URL\n\n# Restore files\ntar -xzf backups/files-20251027-120000.tar.gz -C /\n```\n\n---\n\n## Rollback Procedures\n\n### 1. Automatic Rollback on Deployment Failure\n\n```bash\n# The deploy.sh script includes automatic rollback\n# if health checks fail\n\n# Manual rollback\nsudo systemctl stop bilancompetence-api\ncd /var/backups/bilancompetence\nsudo cp -r backup-YYYYMMDD-HHMMSS/* /var/www/bilancompetence/\nsudo systemctl start bilancompetence-api\n```\n\n### 2. Database Rollback\n\n```bash\n# List available backups\nls -la /backups/db-*.sql.gz\n\n# Restore specific backup\ngunzip < /backups/db-YYYYMMDD-HHMMSS.sql.gz | psql $DATABASE_URL\n```\n\n---\n\n## Troubleshooting\n\n### Issue: Service won't start\n\n```bash\n# Check for errors\nsudo journalctl -u bilancompetence-api -n 50\n\n# Verify configuration\nsudo systemctl status bilancompetence-api -l\n\n# Check port conflicts\nsudo netstat -tulpn | grep 3001\n```\n\n### Issue: High memory usage\n\n```bash\n# Monitor memory\nwatch free -h\n\n# Check process memory\nps aux | grep node\n\n# Restart services\nsudo systemctl restart bilancompetence-api\n```\n\n### Issue: Database connection errors\n\n```bash\n# Test database connection\npsql $DATABASE_URL -c \"SELECT version();\"\n\n# Check network connectivity\ntelnet db.host 5432\n\n# Review logs\ntail -f logs/combined.log | grep DATABASE\n```\n\n### Issue: SSL certificate issues\n\n```bash\n# Verify certificate\nsudo certbot certificates\n\n# Renew certificate\nsudo certbot renew --dry-run\n\n# Manual renewal\nsudo certbot renew --force-renewal\n```\n\n---\n\n## Post-Deployment Checklist\n\n- [ ] All services running and healthy\n- [ ] SSL certificates valid\n- [ ] Database backups running\n- [ ] Monitoring alerts configured\n- [ ] Logs being collected\n- [ ] DNS records pointing correctly\n- [ ] Email service working\n- [ ] Real-time messaging functional\n- [ ] Mobile API accessible\n- [ ] Performance metrics baseline set\n\n---\n\n## Support & Contact\n\n- **Documentation**: https://docs.bilancompetence.ai\n- **API Support**: api-support@bilancompetence.ai\n- **Emergency**: emergency@bilancompetence.ai\n- **Status Page**: https://status.bilancompetence.ai\n\n---\n\n**Last Updated**: October 27, 2025  \n**Deployment Status**: ✅ Production Ready\n